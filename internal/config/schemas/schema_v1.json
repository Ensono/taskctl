{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://github.com/Ensono/taskctl/internal/config/config-definition",
    "$ref": "#/$defs/ConfigDefinition",
    "$defs": {
        "Binary": {
            "properties": {
                "bin": { "type": "string" },
                "args": { "items": { "type": "string" }, "type": "array" }
            },
            "additionalProperties": false,
            "type": "object",
            "required": ["bin"]
        },
        "ConfigDefinition": {
            "properties": {
                "import": { "items": { "type": "string" }, "type": "array" },
                "contexts": {
                    "additionalProperties": {
                        "$ref": "#/$defs/ContextDefinition"
                    },
                    "type": "object"
                },
                "pipelines": {
                    "additionalProperties": {
                        "items": { "$ref": "#/$defs/PipelineDefinition" },
                        "type": "array"
                    },
                    "type": "object"
                },
                "tasks": {
                    "additionalProperties": {
                        "$ref": "#/$defs/TaskDefinition"
                    },
                    "type": "object"
                },
                "watchers": {
                    "additionalProperties": {
                        "$ref": "#/$defs/WatcherDefinition"
                    },
                    "type": "object"
                },
                "debug": { "type": "boolean" },
                "dry_run": { "type": "boolean" },
                "summary": { "type": "boolean" },
                "output": {
                    "type": "string",
                    "enum": ["raw", "cockpit", "prefixed"]
                },
                "variables": {
                    "additionalProperties": { "type": "string" },
                    "type": "object"
                }
            },
            "additionalProperties": false,
            "type": "object",
            "required": ["tasks"]
        },
        "ContextDefinition": {
            "properties": {
                "dir": { "type": "string" },
                "up": { "items": { "type": "string" }, "type": "array" },
                "down": { "items": { "type": "string" }, "type": "array" },
                "before": { "items": { "type": "string" }, "type": "array" },
                "after": { "items": { "type": "string" }, "type": "array" },
                "env": {
                    "additionalProperties": { "type": "string" },
                    "type": "object"
                },
                "envfile": { "$ref": "#/$defs/Envfile" },
                "variables": {
                    "additionalProperties": { "type": "string" },
                    "type": "object"
                },
                "executable": { "$ref": "#/$defs/Binary" },
                "quote": { "type": "string" }
            },
            "additionalProperties": false,
            "type": "object"
        },
        "Envfile": {
            "properties": {
                "generate": { "type": "boolean" },
                "exclude": { "items": { "type": "string" }, "type": "array" },
                "include": { "items": { "type": "string" }, "type": "array" },
                "path": { "type": "string" },
                "replace_char": { "type": "string" },
                "quote": { "type": "boolean" },
                "delay": { "type": "integer" },
                "modify": {
                    "items": { "$ref": "#/$defs/ModifyEnv" },
                    "type": "array"
                },
                "generated_dir": { "type": "string" }
            },
            "additionalProperties": false,
            "type": "object"
        },
        "ModifyEnv": {
            "properties": {
                "pattern": { "type": "string" },
                "operation": { "type": "string", "enum": ["upper", "lower"] }
            },
            "additionalProperties": false,
            "type": "object",
            "required": ["pattern", "operation"]
        },
        "PipelineDefinition": {
            "oneOf": [
                { "required": ["task"], "title": "task" },
                { "required": ["pipeline"], "title": "pipeline" }
            ],
            "properties": {
                "name": { "type": "string" },
                "condition": { "type": "string" },
                "task": { "type": "string" },
                "pipeline": { "type": "string" },
                "depends_on": {
                    "oneOf": [{ "type": "string" }, { "type": "array" }],
                    "items": { "type": "string" }
                },
                "allow_failure": { "type": "boolean" },
                "dir": { "type": "string" },
                "env": {
                    "additionalProperties": { "type": "string" },
                    "type": "object"
                },
                "variables": {
                    "additionalProperties": { "type": "string" },
                    "type": "object"
                }
            },
            "additionalProperties": false,
            "type": "object"
        },
        "TaskDefinition": {
            "properties": {
                "name": { "type": "string" },
                "description": { "type": "string" },
                "condition": { "type": "string" },
                "command": {
                    "oneOf": [{ "type": "string" }, { "type": "array" }],
                    "items": { "type": "string" }
                },
                "after": { "items": { "type": "string" }, "type": "array" },
                "before": { "items": { "type": "string" }, "type": "array" },
                "context": { "type": "string" },
                "variations": {
                    "items": {
                        "additionalProperties": { "type": "string" },
                        "type": "object"
                    },
                    "type": "array"
                },
                "dir": { "type": "string" },
                "timeout": { "type": "integer" },
                "allow_failure": { "type": "boolean" },
                "interactive": { "type": "boolean" },
                "export_as": { "type": "string" },
                "env": {
                    "additionalProperties": { "type": "string" },
                    "type": "object"
                },
                "env_file": { "type": "string" },
                "variables": {
                    "oneOf": [{ "type": "string" }, { "type": "integer" }],
                    "additionalProperties": { "type": "string" }
                }
            },
            "additionalProperties": false,
            "type": "object",
            "required": ["command"]
        },
        "WatcherDefinition": {
            "properties": {
                "events": { "items": { "type": "string" }, "type": "array" },
                "watch": { "items": { "type": "string" }, "type": "array" },
                "exclude": { "items": { "type": "string" }, "type": "array" },
                "task": { "type": "string" },
                "variables": {
                    "additionalProperties": { "type": "string" },
                    "type": "object"
                }
            },
            "additionalProperties": false,
            "type": "object",
            "required": ["events", "watch", "task"]
        }
    }
}
